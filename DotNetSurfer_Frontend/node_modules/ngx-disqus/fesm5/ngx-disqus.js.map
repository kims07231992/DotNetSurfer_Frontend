{"version":3,"file":"ngx-disqus.js.map","sources":["ng://ngx-disqus/lib/disqus.token.ts","ng://ngx-disqus/lib/window.service.ts","ng://ngx-disqus/lib/disqus.service.ts","ng://ngx-disqus/lib/disqus.component.ts","ng://ngx-disqus/lib/disqus.module.ts"],"sourcesContent":["import { InjectionToken } from '@angular/core';\r\n\r\nexport const SHORTNAME = new InjectionToken<string>('SHORTNAME');\r\n","import { isPlatformBrowser } from '@angular/common';\r\nimport { ClassProvider, FactoryProvider, InjectionToken, PLATFORM_ID } from '@angular/core';\r\n\r\nexport const WINDOW = new InjectionToken('WindowToken');\r\n\r\n/* Define abstract class for obtaining reference to the global window object. */\r\nexport abstract class WindowRef {\r\n\r\n  get nativeWindow(): Window | Object {\r\n    throw new Error('Not implemented.');\r\n  }\r\n\r\n}\r\n\r\n/* Define class that implements the abstract class and returns the native window object. */\r\nexport class BrowserWindowRef extends WindowRef {\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  get nativeWindow(): Window | Object {\r\n    return window;\r\n  }\r\n\r\n}\r\n\r\n/* Create an factory function that returns the native window object. */\r\nexport function windowFactory(browserWindowRef: BrowserWindowRef, platformId: Object): Window | Object {\r\n  if (isPlatformBrowser(platformId)) {\r\n    return browserWindowRef.nativeWindow;\r\n  }\r\n  return new Object();\r\n}\r\n\r\n/* Create a injectable provider for the WindowRef token that uses the BrowserWindowRef class. */\r\nexport const browserWindowProvider: ClassProvider = {\r\n  provide: WindowRef,\r\n  useClass: BrowserWindowRef\r\n};\r\n\r\n/* Create an injectable provider that uses the windowFactory function for returning the native window object. */\r\nexport const windowProvider: FactoryProvider = {\r\n  provide: WINDOW,\r\n  useFactory: windowFactory,\r\n  deps: [ WindowRef, PLATFORM_ID ]\r\n};\r\n\r\n/* Create an array of providers. */\r\nexport const WINDOW_PROVIDERS = [\r\n  browserWindowProvider,\r\n  windowProvider\r\n];\r\n","import { Injectable, Inject } from '@angular/core';\r\nimport { SHORTNAME } from './disqus.token';\r\nimport { WINDOW } from './window.service';\r\n\r\n@Injectable()\r\nexport class DisqusService {\r\n\r\n  get DISQUS(): any {\r\n    return this._window.DISQUS;\r\n  }\r\n\r\n  get disqus_config(): any {\r\n    return this._window.disqus_config;\r\n  }\r\n\r\n  set disqus_config(config: any) {\r\n    this._window.disqus_config = config;\r\n  }\r\n\r\n  constructor( @Inject(SHORTNAME) public shortname: string, @Inject(WINDOW) private _window: any) {\r\n  }\r\n}\r\n\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  OnChanges,\r\n  Renderer2,\r\n  ElementRef,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy\r\n} from '@angular/core';\r\nimport { DisqusService } from './disqus.service';\r\nimport { DisqusComment, DisqusReady } from './disqus.model';\r\n\r\n@Component({\r\n  selector: 'disqus',\r\n  template: '<div id=\"disqus_thread\"></div>',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\n\r\nexport class DisqusComponent implements OnChanges {\r\n\r\n  /** DISQUS options */\r\n  @Input() url: string;\r\n  @Input() identifier: string;\r\n  @Input() title: string;\r\n  @Input() category: string;\r\n  @Input() language: string;\r\n\r\n  /** DISQUS events */\r\n  @Output() newComment = new EventEmitter<DisqusComment>(true);\r\n  @Output() ready = new EventEmitter<DisqusReady>(true);\r\n  @Output() paginate = new EventEmitter<any>(true);\r\n\r\n  constructor(private renderer: Renderer2, private el: ElementRef, private dService: DisqusService) {\r\n   }\r\n\r\n  ngOnChanges() {\r\n    /** Reset Disqus if any input changed */\r\n\r\n    if (!this.dService.DISQUS) {\r\n      this.addDisqusScript();\r\n    } else {\r\n      this.reset();\r\n    }\r\n  }\r\n\r\n  /** Add DISQUS script */\r\n  addDisqusScript() {\r\n\r\n    /** Set DISQUS config */\r\n    this.dService.disqus_config = this.getConfig();\r\n\r\n    const disqusScript = this.renderer.createElement('script');\r\n    disqusScript.src = `//${this.dService.shortname}.disqus.com/embed.js`;\r\n    disqusScript.async = true;\r\n    disqusScript.type = 'text/javascript';\r\n    this.renderer.setAttribute(disqusScript, 'data-timestamp', new Date().getTime().toString());\r\n    this.renderer.appendChild(this.el.nativeElement, disqusScript);\r\n  }\r\n\r\n  /** Reset DISQUS with the new config */\r\n  reset() {\r\n    this.dService.DISQUS.reset({\r\n      reload: true,\r\n      config: this.getConfig()\r\n    });\r\n  }\r\n\r\n  /** Create DISQUS config from inputs */\r\n  getConfig() {\r\n    const self = this;\r\n    return function () {\r\n      this.page.identifier = self.identifier;\r\n      this.page.url = self.validateUrl(self.url);\r\n      this.page.title = self.title;\r\n      this.category_id = self.category;\r\n      this.language = self.language;\r\n\r\n      /* Available callbacks are afterRender, onInit, onNewComment, onPaginate, onReady, preData, preInit, preReset */\r\n      this.callbacks.onNewComment = [(e) => {\r\n        self.newComment.emit(e);\r\n      }];\r\n\r\n      this.callbacks.onReady = [(e) => {\r\n        self.ready.emit(e);\r\n      }];\r\n\r\n      this.callbacks.onPaginate = [(e) => {\r\n        self.paginate.emit(e);\r\n      }];\r\n    };\r\n  }\r\n\r\n  validateUrl(url: string) {\r\n    /** Validate URL input */\r\n    if (url) {\r\n      const r = /(http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/;\r\n\r\n      if (r.test(url)) {\r\n        return url;\r\n      } else {\r\n        console.warn('[Disqus]: Invalid URL, return undefined');\r\n      }\r\n    }\r\n    /** DISQUS will fallback to \"Window.location.href\" when URL is undefined */\r\n    return undefined;\r\n  }\r\n\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { DisqusComponent } from './disqus.component';\r\nimport { DisqusService } from './disqus.service';\r\nimport { SHORTNAME } from './disqus.token';\r\nimport { WINDOW_PROVIDERS, WINDOW } from './window.service';\r\n\r\n/** Initialize Disqus with shortname */\r\nexport function DisqusFactory(shortname: string, window: any) {\r\n  return new DisqusService(shortname, window);\r\n}\r\n\r\n@NgModule({\r\n  declarations: [DisqusComponent],\r\n  exports: [DisqusComponent]\r\n})\r\nexport class DisqusModule {\r\n  static forRoot(shortname: string): ModuleWithProviders {\r\n    return {\r\n      ngModule: DisqusModule,\r\n      providers: [\r\n        WINDOW_PROVIDERS,\r\n        { provide: SHORTNAME, useValue: shortname },\r\n        {\r\n          provide: DisqusService,\r\n          useFactory: DisqusFactory,\r\n          deps: [SHORTNAME, WINDOW]\r\n        },\r\n      ]\r\n    };\r\n  }\r\n}\r\n"],"names":["tslib_1.__extends"],"mappings":"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"}
